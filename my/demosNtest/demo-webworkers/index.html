<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>ROBODE using WebWorkers</title>
    <script src="jquery.min.js" type="text/javascript"></script>
    <!-- <script src="parallel.js" type="text/javascript"></script> -->
    <script src="bezier.js" type="text/javascript"></script>
    <script src="Box2d.min.js" type="text/javascript"></script>
    <script src="robode.js" type="text/javascript"></script>
    <script src="circuit.js" type="text/javascript"></script>
    <script src="vkthread/worker.js" type="text/javascript"></script>
    <script src="vkthread/vkthread.js" type="text/javascript"></script>
    <script type="text/javascript">
        var world;
        var worldScale = 10.0;
        var mydemocar;

        function init() {

            //create the world
            world = new b2World(
                new b2Vec2(0, 0) //gravity
                , true //allow sleep
            );

            //setup debug draw
            var myDebugDraw = new b2DebugDraw();
            myDebugDraw.SetSprite(document.getElementById("mycanvas").getContext("2d"));
            myDebugDraw.SetDrawScale(worldScale);
            myDebugDraw.SetFillAlpha(0.3);
            myDebugDraw.SetLineThickness(1.0);
            myDebugDraw.SetFlags(b2DebugDraw.e_shapeBit | b2DebugDraw.e_jointBit);
            world.SetDebugDraw(myDebugDraw);


            //create the circuit
            createCircuit();

            //create the car
            mydemocar = new demoCar();
        }

        function update() {
            world.Step(
                1 / 60 //frame-rate
                , 10 //velocity iterations
                , 10 //position iterations
            );
            world.DrawDebugData();
            world.ClearForces();
            mydemocar.updateMovement();
        }


        $(document).ready(function() {
            init();
            window.setInterval(update, 1000 / 60);
            console.log('ready');


            function fun1(){
                console.log(document.getElementById("mycanvas"));
            }
            vkthread.run(fun1, []).then((data)=>{console.log('then');});

            // var worker = new Worker('workertest.js');
            // worker.onmessage = function(e) {
            //     console.log("Received: " + e.data);
            // }
            // worker.postMessage(""); // Start the worker.



        });
    </script>
</head>

<body>
    <canvas id="mycanvas" width="320" height="320">Canvas not supported.</canvas>
</body>

</html>

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>ROBODE playing with WebWorkers</title>
    <script src="jquery.min.js" type="text/javascript"></script>
    <script src="bezier.js" type="text/javascript"></script>
    <script src="Box2d.min.js" type="text/javascript"></script>
    <script src="robode.js" type="text/javascript"></script>
    <script src="circuit.js" type="text/javascript"></script>
    <script type="text/javascript">
        var world;
        var myDemoCar;

        function init() {

            var worldScale = 10.0;

            //create the world
            world = new b2World(
                new b2Vec2(0, 0) //gravity
                , true //allow sleep
            );

            //setup debug draw
            setDraw(new b2DebugDraw(), world, "mycanvas", worldScale);
            window.setInterval(update, 1000 / 60);

            //create the circuit
            createCircuit();

            //create the car
            myDemoCar = new demoCar();

            console.log('robode ready');
        };


        function setDraw(myDebugDraw, myWorld, myCanvas, myWorldScale) {

            myDebugDraw.SetSprite(document.getElementById(myCanvas).getContext("2d"));
            myDebugDraw.SetDrawScale(myWorldScale);
            myDebugDraw.SetFillAlpha(0.3);
            myDebugDraw.SetLineThickness(1.0);
            myDebugDraw.SetFlags(b2DebugDraw.e_shapeBit | b2DebugDraw.e_jointBit);
            myWorld.SetDebugDraw(myDebugDraw);
        }

        function update() {
            world.Step(
                1 / 60 //frame-rate
                , 10 //velocity iterations
                , 10 //position iterations
            );

            world.DrawDebugData();
            world.ClearForces();

            myDemoCar.updateMovement();

        };
        $(document).ready(function() {
            console.log("ready");
            init();
        });
    </script>
</head>

<body>
    <canvas id="mycanvas" width="320" height="320">Canvas not supported.</canvas>
</body>

</html>
